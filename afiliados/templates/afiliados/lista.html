<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Afiliados</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>

{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">

    <h2 class="mb-4">Lista de Afiliados</h2>

    <!-- üîπ BOTONES DE ACCI√ìN -->
    <div class="mb-3">
        <a href="{% url 'crear_afiliado' %}" class="btn btn-success">‚ûï Crear Afiliado</a>
        <a href="{% url 'carga_excel' %}" class="btn btn-warning">üìÇ Carga Masiva</a>
        <a href="{% url 'exportar_excel' %}?{{ request.GET.urlencode }}" class="btn btn-info">üì§ Exportar Excel</a>
    </div>

    <!-- üîπ FORMULARIO DE B√öSQUEDA Y FILTROS -->
   <form method="get" class="row mb-3">
  <div class="col">
    <input type="text" name="q" class="form-control" placeholder="Buscar por nombre o DNI" 
           value="{{ request.GET.get('q','') }}">
  </div>
  <div class="col">
    <input type="text" name="numero_afiliado" class="form-control" placeholder="N√∫mero Afiliado" 
           value="{{ request.GET.get('numero_afiliado','') }}">
  </div>
  <div class="col">
    <select name="sector" class="form-select">
        <option value="">Todos los sectores</option>
        <option value="Norte" {% if request.GET.get('sector') == 'Norte' %}selected{% endif %}>Norte</option>
        <option value="Sur" {% if request.GET.get('sector') == 'Sur' %}selected{% endif %}>Sur</option>
        <option value="Este" {% if request.GET.get('sector') == 'Este' %}selected{% endif %}>Este</option>
        <option value="Oeste" {% if request.GET.get('sector') == 'Oeste' %}selected{% endif %}>Oeste</option>
    </select>
  </div>
  <div class="col">
    <input type="text" name="localidad" class="form-control" placeholder="Localidad" 
           value="{{ request.GET.get('localidad','') }}">
  </div>
  <div class="col-auto form-check me-2">
    <input class="form-check-input" type="checkbox" name="ocultar_hechos" value="1"
           id="ocultar_hechos" {% if request.GET.get('ocultar_hechos') %}checked{% endif %}>
    <label class="form-check-label" for="ocultar_hechos">
        Ocultar hechos
    </label>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary">Filtrar</button>
  </div>
</form>
    <!-- üîπ TABLA DE RESULTADOS -->
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>N√∫mero Afiliado</th>
                <th>Nombre</th>
                <th>DNI</th>
                <th>Localidad</th>
                <th>Sector</th>
                <th>Tel√©fono</th>
                <th>Vot√≥</th>
            </tr>
        </thead>
        <tbody>
            {% for afiliado in afiliados %}
            <tr>
                <td>{{ afiliado.numero_afiliado }}</td>
                <td>{{ afiliado.apellido_nombre }}</td>
                <td>{{ afiliado.dni }}</td>
                <td>{{ afiliado.localidad }}</td>
                <td>{{ afiliado.sector }}</td> <!-- Aqu√≠ muestra la zona como sector -->
                <td>{{ afiliado.telefono }}</td>
                <td>
                    {% if afiliado.hecho %}
                        S√≠
                    {% else %}
                        No
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'editar_afiliado' afiliado.id %}" class="btn btn-sm btn-primary">‚úè Editar</a>
                    <a href="{% url 'eliminar_afiliado' afiliado.id %}" class="btn btn-sm btn-danger"
                       onclick="return confirm('¬øEst√°s seguro de eliminar este afiliado?')">üóë Eliminar</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">No se encontraron resultados</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>